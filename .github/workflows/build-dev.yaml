##name: Polybot build Dev
##
##on:
##  push:
##    branches:
##      - dev
##
##jobs:
##  build:
##    runs-on: ubuntu-latest
##    outputs:
##      image: ${{ steps.build-image.outputs.image }}
##
##    steps:
##      - uses: actions/checkout@v4
##
##      - name: Log in to DockerHub
##        run: echo "${{ secrets.DOCKERHUB_TOKEN }}" | docker login -u "${{ secrets.DOCKERHUB_USERNAME }}" --password-stdin
##
##      - name: build and push Docker image
##        id: build-image
##        run: |
##          IMAGE_NAME=${{ secrets.DOCKERHUB_USERNAME }}/polybot-dev:${{ github.run_number }}
##          echo "🔧 Image name: $IMAGE_NAME"
##          docker build -t $IMAGE_NAME .
##          docker push $IMAGE_NAME
##          echo "image=$IMAGE_NAME" >> "${GITHUB_OUTPUT}"
##      - name: 🔍 Debug image output  # ← this is your debug step
##        run: |
##          echo "Image output from build-image: ${{ steps.build-image.outputs.image }}"
##
##
##  deploy:
##    needs: build
##    uses: ./.github/workflows/deployment-dev.yaml
##    with:
##      image: ${{ needs.build.outputs.image }}
##    secrets:
##      EC2_SSH_KEY: ${{ secrets.EC2_SSH_KEY }}
##      POLYBOT_EC2_IP_DEV: ${{ secrets.POLYBOT_EC2_IP_DEV }}
##      TELEGRAM_BOT_TOKEN_DEV: ${{ secrets.TELEGRAM_BOT_TOKEN_DEV }}
##      BOT_APP_URL_DEV: ${{ secrets.BOT_APP_URL_DEV }}
##      YOLO_SERVER_URL_DEV: ${{ secrets.YOLO_SERVER_URL_DEV }}
##      S3_BUCKET_NAME_DEV: ${{ secrets.S3_BUCKET_NAME_DEV }}
#
#name: Polybot Build Dev
#
#on:
#  push:
#    branches:
#      - dev
#
#jobs:
#  build:
#    runs-on: ubuntu-latest
#    outputs:
#      image: ${{ steps.build-image.outputs.image }}
#
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v4
#
#      - name: Log in to DockerHub
#        run: echo "${{ secrets.DOCKERHUB_TOKEN }}" | docker login -u "${{ secrets.DOCKERHUB_USERNAME }}" --password-stdin
#
#      - name: Build and push Docker image
#        id: build-image
#        run: |
#          IMAGE_NAME=${{ secrets.DOCKERHUB_USERNAME }}/polybot-dev:${{ github.run_number }}
#          echo "🔧 Built image: $IMAGE_NAME"
#          docker build -t $IMAGE_NAME .
#          docker push $IMAGE_NAME
#          echo "image=$IMAGE_NAME" >> "${GITHUB_OUTPUT}"
#
#  deploy:
#    needs: build
#    uses: merryshalabi/PolybotServicePython/.github/workflows/deployment-dev.yaml@dev
#
#    with:
#      image: ${{ needs.build.outputs.image }}
#    secrets:
#      EC2_SSH_KEY: ${{ secrets.EC2_SSH_KEY }}
#      POLYBOT_EC2_IP_DEV: ${{ secrets.POLYBOT_EC2_IP_DEV }}
#      TELEGRAM_BOT_TOKEN_DEV: ${{ secrets.TELEGRAM_BOT_TOKEN_DEV }}
#      BOT_APP_URL_DEV: ${{ secrets.BOT_APP_URL_DEV }}
#      YOLO_SERVER_URL_DEV: ${{ secrets.YOLO_SERVER_URL_DEV }}
#      S3_BUCKET_NAME_DEV: ${{ secrets.S3_BUCKET_NAME_DEV }}
#

name: Polybot Build Dev

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    outputs:
      image: ${{ steps.build-image.outputs.image }}

    steps:
      - name: Set test image
        id: build-image
        run: |
          IMAGE_NAME=test/polybot-dev:${{ github.run_number }}
          echo "image=$IMAGE_NAME" >> $GITHUB_OUTPUT

  deploy:
    needs: build
    uses: merryshalabi/PolybotServicePython/.github/workflows/deployment-dev.yaml@dev
    with:
      image: ${{ needs.build.outputs.image }}

